---
import PortfolioLayout from "@/layouts/PortfolioLayout.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("portfolios");

  return entries
    .filter((e) => {
      const fmLang = (e.data as any).lang as string | undefined;
      const raw = String(e.slug ?? e.id);   // slug may be undefined with glob loader
      return fmLang === "en" || raw.startsWith("en/");
    })
    .map((entry) => {
      const raw = String(entry.slug ?? entry.id);
      // strip leading lang and trailing /index for clean URLs
      const rest = raw.replace(/^en\/|^el\//, "").replace(/\/index$/, "");
      return { params: { slug: rest }, props: { entryId: entry.id } };
    });
}

const { entryId } = Astro.props as { entryId: string };
const entry = await getEntry("portfolios", entryId);
---

<PortfolioLayout portfolio={entry as any} />

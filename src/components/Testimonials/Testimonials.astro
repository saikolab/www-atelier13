---
/**
 * * This is a testimonials section that displays three testimonials
 *
 */

import TestimonialCard from "@components/TestimonialCard/TestimonialCard.astro";
import { getCollection } from "astro:content";
import { getLangFromUrl } from "@/i18n/utils";
import type { Locale } from "@/i18n/config";
import { t } from "@/i18n/ui";

// detect language from URL
const lang: Locale = getLangFromUrl(Astro.url);

// fetch all; texts are selected per-locale from suffixed fields
const filtered = await getCollection("testimonials");

const sortedTestimonials = filtered.sort((a, b) => {
	if (a.data.order < b.data.order) {
		return -1;
	}
	if (a.data.order > b.data.order) {
		return 1;
	}
	return 0;
});

const firstThreeTestimonials = sortedTestimonials.slice(0, 3);
---

<section id="testimonial" class="site-container scroll-mt-10 py-8 md:py-12">
	<div class="mx-auto max-w-6xl text-center">
    <h2 class="h2 text-pretty uppercase">{t(lang, 'testimonialsSection', 'title')}</h2>
	</div>
  <div class="mx-auto grid max-w-md gap-20 pt-8 md:pt-12 lg:max-w-none lg:grid-cols-3">
    {firstThreeTestimonials.map((t, idx) => (
      <TestimonialCard testimonial={t} lang={lang} imagePosition={idx % 2 === 1 ? "bottom" : "top"} />
    ))}
  </div>
</section>

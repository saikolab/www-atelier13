---
/**
 * * Three portfolio cards (1 large + 2 small), i18n-ready
 */

import Button from "@components/Button/Button.astro";
import PortfolioCard from "@components/PortfolioCard/PortfolioCard.astro";
import { getCollection } from "astro:content";

import type { Locale } from "@/i18n/config";
import { getLangFromUrl, localizedPath } from "@/i18n/utils";
import { t } from "@/i18n/ui";

interface Props { lang?: Locale }

// detect language from props or URL
const urlLang = getLangFromUrl(Astro.url);
const { lang = urlLang } = Astro.props as Props;

// fetch & filter by language if frontmatter has `lang`
const allPortfolios = await getCollection("portfolios");
const byLang = allPortfolios.filter((e) => !("lang" in e.data) || e.data.lang === lang);

// sort by `order` (ascending)
const sorted = byLang.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));

// take up to three to display
const firstThreePortfolios = sorted.slice(0, 3);
---

<section id="portfolio" class="site-container mt-12 scroll-mt-10 py-8 md:py-12">
  <div class="mx-auto max-w-6xl text-center">
    <h2 class="h2 text-pretty uppercase">
      {t(lang, "portfolioSection", "headline")}
    </h2>
  </div>

  {firstThreePortfolios.length >= 3 ? (
    <div class="grid gap-10 pt-8 md:grid-cols-2 md:pt-12">
      <div class="md:bg-base-100 md:rounded-md md:p-10 md:pb-6">
        <PortfolioCard portfolio={firstThreePortfolios[0]} direction="vertical" />
      </div>
      <div class="flex h-full flex-col justify-between gap-y-6">
        <PortfolioCard portfolio={firstThreePortfolios[1]} direction="horizontal" />
        <hr class="border-base-100 hidden border md:block" />
        <PortfolioCard portfolio={firstThreePortfolios[2]} direction="horizontal" />
      </div>
    </div>
  ) : firstThreePortfolios.length > 0 ? (
    // If 1-2 items exist, show a simple grid of what's available
    <div class="grid gap-10 pt-8 md:grid-cols-2 md:pt-12">
      {firstThreePortfolios.map((p) => (
        <div class="md:bg-base-100 md:rounded-md md:p-10 md:pb-6">
          <PortfolioCard portfolio={p} direction="vertical" />
        </div>
      ))}
    </div>
  ) : (
    // No localized items exist yet
    <div class="mx-auto max-w-3xl pt-10 text-center opacity-70">
      <p>{t(lang, "portfolioSection", "fallback")}</p>
    </div>
  )}

  <div class="mt-12 flex justify-center">
    <Button href={localizedPath(lang, "/portfolio")} variant="outline">
      {t(lang, "portfolioSection", "viewAll")}
    </Button>
  </div>
</section>

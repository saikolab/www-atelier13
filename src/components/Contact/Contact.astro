---
/**
 * * Contact section for the website
 */

import { Icon } from "astro-icon/components";
import contactData from "@config/contactData.json";
import { Image } from "astro:assets";
import type { Locale } from "@/i18n/config";
import { getLangFromUrl } from "@/i18n/utils";
import { t } from "@/i18n/ui";

interface Props { class?: string; lang?: Locale }
const urlLang = getLangFromUrl(Astro.url);
const { class: className, lang = urlLang } = Astro.props as Props;

import ringsImage from "@assets/images/k17-019.jpg";

// Build helpers for dynamic contact links
const email = contactData.email;
const phone = contactData.phone;
const instagramUrl = contactData.instagramUrl;
const whatsappNumber = contactData.whatsapp;
const whatsappSanitized = (whatsappNumber || "").replace(/[^\d]/g, "");
const whatsappHref = whatsappSanitized ? `https://wa.me/${whatsappSanitized}` : undefined;
let instagramHandle = "";
try {
  const u = new URL(instagramUrl);
  instagramHandle = u.pathname.replace(/^\//, "");
} catch {}
---

<section
	id="contact"
	class="mx-auto max-w-md scroll-mt-10 px-4 py-8 md:max-w-6xl md:py-12"
	class:list={[className]}
>
	<h2 class="h2 md:px-12 lg:text-6xl">{t(lang, 'contactSection', 'title')}</h2>
	<div class="grid gap-y-10 md:grid-cols-2">
		<div class="border-primary-300 pt-8 md:border-r md:pr-20 md:pl-12">
			<p class="description text-lg">{t(lang, 'contactSection', 'body')}</p>
			<div class="mx-auto mt-8 aspect-square overflow-hidden">
				<Image
					src={ringsImage}
					alt={t(lang, 'contactSection', 'imageAlt')}
					width={450}
					densities={[1.5, 2]}
					class="h-full w-full object-cover"
				/>
			</div>
		</div>
		<div class="md:pr-12 md:pl-20">
			<div class="flex flex-col gap-3">
				{email && (
					<a href={`mailto:${email}`} class="group flex items-center justify-between gap-4 rounded-lg border border-primary-300 p-4 transition hover:bg-base-100/50">
						<div class="flex items-center gap-3">
							<Icon name="socials/mdi-mail" class="size-6 text-primary-500 transition group-hover:opacity-80" />
							<div>
								<div class="font-medium">{t(lang, 'contactPage', 'email')}</div>
								<div class="text-sm opacity-80">{email}</div>
							</div>
						</div>
						<span class="text-primary-600 text-sm">{t(lang, 'contactPage', 'sendEmail')}</span>
					</a>
				)}

				{phone && (
					<a href={`tel:${phone.replace(/\s/g, '')}`} class="group flex items-center justify-between gap-4 rounded-lg border border-primary-300 p-4 transition hover:bg-base-100/50">
						<div class="flex items-center gap-3">
							<Icon name="socials/mdi-telephone" class="size-6 text-primary-500 transition group-hover:opacity-80" />
							<div>
								<div class="font-medium">{t(lang, 'contactPage', 'phone')}</div>
								<div class="text-sm opacity-80">{phone}</div>
							</div>
						</div>
						<span class="text-primary-600 text-sm">{t(lang, 'contactPage', 'callNow')}</span>
					</a>
				)}

				{whatsappHref && (
					<a href={whatsappHref} target="_blank" rel="noopener noreferrer" class="group flex items-center justify-between gap-4 rounded-lg border border-primary-300 p-4 transition hover:bg-base-100/50">
						<div class="flex items-center gap-3">
							<Icon name="socials/mdi-telephone" class="size-6 text-primary-500 transition group-hover:opacity-80" />
							<div>
								<div class="font-medium">{t(lang, 'contactPage', 'whatsapp')}</div>
								<div class="text-sm opacity-80">{whatsappNumber}</div>
							</div>
						</div>
						<span class="text-primary-600 text-sm">{t(lang, 'contactPage', 'openOnWhatsApp')}</span>
					</a>
				)}

				{instagramUrl && (
					<a href={instagramUrl} target="_blank" rel="noopener noreferrer" class="group flex items-center justify-between gap-4 rounded-lg border border-primary-300 p-4 transition hover:bg-base-100/50">
						<div class="flex items-center gap-3">
							<Icon name="socials/basil-instagram-solid" class="size-6 text-primary-500 transition group-hover:opacity-80" />
							<div>
								<div class="font-medium">{t(lang, 'contactPage', 'instagram')}</div>
								<div class="text-sm opacity-80">@{instagramHandle || instagramUrl}</div>
							</div>
						</div>
						<span class="text-primary-600 text-sm">{t(lang, 'contactPage', 'visitInstagram')}</span>
					</a>
				)}
			</div>
		</div>
	</div>
</section>
